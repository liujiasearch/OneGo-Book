---
description: >-
  日本漫画《棋魂》把很多年轻人引领进围棋的世界。我再推荐两本有趣的围棋入门书籍，也都是漫画形式，虽然不像棋魂那么长，但是非常具有可读性。它们分别是《漫画围棋入门：基础篇》和《漫画围棋入门：实战篇》，这两本书是日本片冈聪先生监修，石仓淳先生绘制的专门为围棋初学者创作的漫画书。基础编相当于入门读物，实战编相当于初级读物。
---

# 第一章 围棋：黑白的世界

## 1.1 什么是围棋

中国有句俗语“没吃过猪肉,谁还没见过猪跑”。围棋应该就属于这一类。它起源于中国，在古代被称作“弈”，也有人叫“手谈”。两个人下围棋也叫做对弈。现在围棋作为一种国际通行棋种流行于东亚（中、日、韩），在欧美国家也逐渐风行。围棋的英语名称是“Go”，来源于日本对围棋的称呼“囲碁”（いご）中的“碁”。现实中的围棋棋具如图1-1。

![&#x56FE; 1 - 1 &#x65E5;&#x5E38;&#x751F;&#x6D3B;&#x4E2D;&#x4EBA;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x56F4;&#x68CB;&#x68CB;&#x5177;](.gitbook/assets/image%20%288%29.png)

一般一套围棋棋具由棋子（stone）与棋盘（board）组成。棋子分黑白两色，多为扁圆形，材料多为树脂。在中国，棋子一般一面平整，一面凸起。行棋时，平整的一面向下落在棋盘上。在日本，棋子两面通常都是凸起的。棋子的数量一般是180枚，由于几乎不会有人把棋盘下满才结束的情况，所以这个数量在实际日常使用中是完全足够的。围棋的棋盘一般使用一块方形的木板，上面画上由横竖各十九条等距离、垂直交叉的平行线。纵横交错的38根直线共构成19×19=361个交叉点（point）。棋盘最中间的位置会专门画上一个点，点叫做“天元”。在其它地方还会额外再画上8个小圆点，称作星位。由天元和星位这9个点把棋盘分割成“角”、“边”以及“中腹”。虽然角、边这些概念在下棋时非常重要，但是星位和天元只是棋盘上9个点的名称，在行棋时并没有实际意义。

如果进行围棋比赛，人们有时还会使用到一种叫“棋钟”的棋具，如图1-2。棋钟其实就是一种计时器，在正式的比赛中使用棋钟对选手的时间进行限制。

![&#x56FE; 1 - 2 &#x7535;&#x5B50;&#x68CB;&#x949F;](.gitbook/assets/image%20%2832%29.png)

随着互联网的普及，很多人更乐于在网络上与别人下棋。在中国，“[弈城围棋网](www.eweiqi.com)”是一个比较著名的围棋对弈网站。在国际上[KGS](http://www.gokgs.com/)是非常热门的围棋对弈站点，它是完全免费的，来自世界各地的人们在上面切磋技艺。网络上一套标准的棋盘如图1-3。大部分的网上对弈棋盘都以两维的形式展现，双方的棋子用白色和黑色的原点表示。除了通过互联网站下棋，一些围棋软件在棋友中使用也十分广泛，这些软件可以为围棋学习提供便利，也可以在亲朋好友间进行对弈。常见的围棋软件有[Gnu-Go](www.gnu.org)和[Pachi](http://pachi.or.cz/)。这两款软件除了能够提供常规功能以外，还自带围棋AI，可以实现简单的人机对战。在[DeepMind](www.deepmind.com)的[AlphaGo](https://deepmind.com/research/alphago/)出现前，他们所配备的围棋AI曾一度是围棋领域所能实现的人工智能的典型代表。还有一些围棋软件仅具备图形界面，可以帮助棋友打谱和人与人的对战，但是本身不配有下棋的AI引擎，围棋软件[Sabaki](https://sabaki.yichuanshen.de)就是其中之一。图1-3显示的是Sabaki的截图。Sabaki自己不带有AI引擎，但是它可以装载其它软件的AI引擎，实现人与AI的对弈。值得称道的一点是，它可以同时装载两种不同的AI引擎，实现黑棋与白棋自动对弈，就好像金庸先生的武侠小说《[神雕侠侣](http://www.jinyongwang.com/shen/)》中提到过的武功---“左右互搏术”。我们可以利用软件的这个特点来评估不同AI间的棋力强弱。

![&#x56FE; 1 - 3 &#x56F4;&#x68CB;&#x8F6F;&#x4EF6;Sabaki&#x7684;&#x68CB;&#x76D8;](.gitbook/assets/image%20%2828%29.png)

## 1.2 围棋的规则

对局开始后，双方各执一种颜色的棋子，交替在棋盘上落子，每次最多只能落一枚棋子，其中执黑色棋子的一方先落子。如果愿意，当前落子的一方可以放弃落子，跳过本回合，称为虚着（pass）。当双方连续都跳过自己的回合，此局便告结束，如果双方无人认输（resign），则棋局进入胜负判定环节。在落子时，棋子只能下在棋盘上的交叉点上。和其它棋牌类游戏一样，一旦落子就不能反悔，而且不可以在棋盘上移动棋子向其他位置运动。

在棋盘上，与棋子相邻的空点称作这颗棋子的气（liberty）。图1-4中用红色线圈框出的点便是这颗黑色棋子的气。由于黑子周围没有被白字占领，所以这颗黑子一共有四口气。如果气的空子位被对方的子占领，则己方就减少一口气。如果图1-4中的空子位1被白子占领，黑子就只剩下了三口气。当空子位1、2、3和4都被白子占领时，这颗黑子的气变为零，称为无气或者气绝，黑子成为一颗死子。死子不能在棋盘上存在，需要从棋盘上被挪走，我们称为提子。

![&#x56FE; 1 - 4 &#x72EC;&#x7ACB;&#x7684;&#x9ED1;&#x5B50;&#x4E00;&#x5171;&#x6709;&#x56DB;&#x53E3;&#x6C14;](.gitbook/assets/image%20%289%29.png)

相同颜色的棋子通过棋盘上纵横的线进行连接，相邻的棋子便可以共享各自的气。图1-5中，虽然左边的黑子上方被白棋占去了一口气，但是由于它右边紧邻着一颗黑子，所以它实际上有五口气。单颗棋子的气有四口，但是相邻的两颗子却只有六口气，虽然增加了各自的存活率，但是从气的数量上来考虑，总的效益时下降的，所以在围棋行棋的初始阶段，双方往往都避免将自己的棋子连在一起，这其中将行棋的效益最大化就是需要考量的因素之一。

![&#x56FE; 1 - 5 &#x767D;&#x68CB;&#x6709;&#x4E09;&#x53E3;&#x6C14;&#xFF0C;&#x9ED1;&#x68CB;&#x6709;5&#x53E3;&#x6C14;](.gitbook/assets/image%20%2812%29.png)

图1-6中，×标记的白子和□标记的黑子共享A点这口气。如果此时由执黑方落子，黑子下到A点，虽然此时黑白双方都是无气状态，但是黑棋下完后应该立即提走×标记的所有白子，这样□标记的黑子便有了气，成为活子。

![&#x56FE; 1 - 6 ](.gitbook/assets/image%20%2818%29.png)

通常的围棋规则都不允许自杀。图1-7中，如果此时执白方落子，下到A点空位。周围的黑子都有气，白子不能提走黑子，而△标记的白子自己却没有了气，需要被从棋盘上提走，这种行为称为自杀。如果规则上不允许自杀，则执白方不允许在A位上落子。

![&#x56FE; 1 - 7](.gitbook/assets/image%20%282%29.png)

虽然大部分情况下自杀是没有意义的，但是有时候兵行险招未尝不是一种方案。图1-8虽然不具有实战意义，但是作为例子，它展现了自杀也是可以成为争取效益的一种手段。如果不允许自杀，通常会判定图中白子全部为死棋，执黑方胜。原因是若黑棋落在A位后就可以提走所有白子。但是如果允许自杀（[应氏规则](https://baike.baidu.com/item/%E5%BA%94%E6%B0%8F%E8%A7%84%E5%88%99/1680973?fr=aladdin)），执白方就可以落在A位，虽然也会被提走全部白子，但是由于空出的领域较大，白棋未必不能争夺到一片领地。我想到金庸先生在小说《[天龙八部](http://www.jinyongwang.com/tian/)》中描写的珍珑棋局大概就属于这种情况。

![&#x56FE; 1 - 8 &#x5175;&#x884C;&#x9669;&#x62DB;](.gitbook/assets/image%20%2817%29.png)

虽然围棋的棋形千变万化，但这是站在19×19这样一个大棋盘上来说的。由于围棋规则简单，行棋的进程中，很容易在局部陷入简单变化，使得棋局陷入死循环。人们经提到的术语“打劫”（K.O.）就是一个常见的例子。图1-9和图1-10就是典型的打劫案例。在图1-9的局势下，当执白方下到A点空位，▲黑子被提走，局势变到图1-10。此时若执黑方下到A点空位，执黑方提掉△白子，局势又回到了图1-9的情况。若双方都不愿意改变策略，此局将进入死循环，无法结束。针对这种情况，围棋中规定，行棋的过程中，任何一方都不可以下出同之前自己下过的相同的围棋局面，围棋术语中称为禁止全局同型再现。在当前的这个例子中，图1-9时，白棋下完A位后，黑棋便不可以再下图1-10中的A位，因为这将会使得局面变回图1-9，而图1-9这局面是黑棋曾经下到过的，黑棋必须在其它位置上落子后，才可以继续在A位下棋。这种在其它位置落子的行为，专业术语就叫做“找劫材”。

![&#x56FE; 1 - 9](.gitbook/assets/image%20%2824%29.png)

![&#x56FE; 1 - 10](.gitbook/assets/image%20%2829%29.png)

## 1.3 胜负的判定

在下棋的过程中，任何一方都可以选择投子，即把两颗棋子放在棋盘右下角表示认输，此时棋局终了。双方还可以连续依次地选择虚着，这样棋局也进入终了，此时若无人认输，则进入胜负判定环节。围棋流传多地，不同地方文化不尽相同，围棋也相应地演变出许多不同的规则。胜负判定也一样，目前世界上使用较多的有[中国规则](https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E5%9B%B4%E6%A3%8B%E8%A7%84%E5%88%99/5425065?fr=aladdin)、[日韩规则](https://baike.baidu.com/item/%E6%97%A5%E6%9C%AC%E5%9B%B4%E6%A3%8B%E8%A7%84%E5%88%99%EF%BC%881989%E7%89%88%EF%BC%89/15175571)和应氏规则。中国大陆采用数子规则，台湾采用应氏计点规则，日韩采用数目规则。数子法计算围取的地域，即双方占领的交叉点的数目。数目法计算双方围取的目数， 包括死子。围棋的本质是以围地为目的行棋， 三种规则都考虑到执黑方先行棋存在一定优势，所有规则都采用了贴目制度。除去技术上采用的计算方式不同之外，三种规则在实践中的差异很小，胜负的结果基本一致。

日韩规则中，棋子所围成的空白交叉点叫做目，最终以目多的一方为胜方，所以日本的围棋规则称为比目法。对局时需保留死子，终局后双方将盘上的死子及行棋过程中提掉的死子填入对方实空中，再计算双方各自剩下的实空。最终结算时，黑棋贴给白棋6目半。如果白棋实空加上贴目后多于黑方则白胜，否则黑胜。

计算胜负时，中国规则与日韩规则有所不同。按照中国规则（数子法），一盘棋结束后，棋盘上的死子被拿掉，如果双方对是否死子产生争议，通过实战解决。之后，如果黑棋活的棋子加上实空（目）达到185（黑棋由于先行优势须贴给白棋7目半）则黑胜，少于此数目则白胜。

而应氏规则是，数各方占据的交叉点的数目，称作“计点”。其中黑棋贴7目半，占点多的一方胜，如果是和棋，则也是黑胜。除去比赛组织和棋手组织的一些规定外，就规则的核心部分而言，应氏规则与中国规则并无明显区别。

中国规则在计算机实现上要比日韩规则方便许多，本书采用的就是中国规则。在实际计算中，采用黑棋贴白棋七目半后比多寡来决定胜负，以图1-11为例，如果行棋至此，双方都接连着虚着，且执黑方认为己方胜，而白方认为自己胜，就需要进入胜负判定环节。此时，棋盘上黑棋有四子，白棋有两子，黑棋还占了左上角一目，故黑棋实际上占有5点。根据规则，胜负结算时，黑棋需贴白棋7.5目，白棋实际上占有9.5点，比黑棋多出4.5点，因此结果为白棋胜。

![&#x56FE; 1 - 11 ](.gitbook/assets/image%20%2813%29.png)

## 1.4 围棋棋手的棋力

棋手等级包括段位和级位。段位和级位是表示围棋手水平高低的标志，从低到高分别为：业余级位，业余段位，职业段位。业余可分为1级、2级一直到25级，其中1级最高，25级最低。一个按照围棋规则随机落子的计算机程序就相当于业余25级。20级到11级一般属于初级入门，10级到1级表示具有中级围棋水平。段位与级位相反，最低为1级。业余段位从1段到7段，日本棋院还有业余8段。1段到7段棋力逐级增强，业余7段表示已经具备了职业棋手的能力。职业段位与业务段位不同，它有点像是荣誉头衔。段位的级数和选手在不同层次的国际比赛中获得的奖项荣誉挂钩，并且一旦获得了某一级别的职业段位，这一荣誉就是终身的。业余段位不能直接和职业段位相比较，不过基本上职业段位选手的棋力至少和业余7段一样强。

业余中一级或者一段的棋力差别主要体现在行棋开局前上一级别的棋手需要让低一级别的棋手先行一子，以此达到双方在公平的基础上对弈。假设读者是围棋的刚入门选手，处于业余23级，如果和职业九段李世石下棋，李世石至少要让读者在棋盘上先放下30子，读者才有可能战胜李世石。这种让对方先在棋盘上落子摆放后才开始下棋的行为称作让子。让子和在终局结算时的贴目行为很像，只是一个发生在棋局开始前，一个发生在行棋结束后。

## 1.5 计算机眼中的围棋

围棋采用黑白两色棋子在方形棋盘上进行。标准的围棋竞技采用19x19路棋盘。《[梦溪笔谈](https://www.gushiwen.org/guwen/mengxi.aspx)》中探讨了围棋的变化数目，沈括认为“大约连书万字四十三个，即是局之大数”。但是实际数字甚至远远超过可观测宇宙的原子总数 $$10^{75}$$ ，约为 $$3^{19×19}=3^{361}≈1.74×10^{172}$$。根据围棋规则，没有气的子不能存活，扣除这些状态后的合法状态（占1.196%）约有 $$2.08×10^{170}$$ 种。而计算机想要确保必胜，需要的计算量在 $$10^{600}$$ 以上。正是因为这个原因，在AlphaGo出现之前，围棋的智能程序一直无法达到像深蓝电脑这样可以战胜世界级象棋大师的棋力水平。1997年IBM的计算机“深蓝”击败俄籍世界国际象棋冠军加里·卡斯帕罗夫，之后经过18年的发展，棋力最高的人工智能围棋程序才大约达到业余5段围棋棋手的水准，在不让子的情况下，根本无法击败职业棋手。2012年，在4台PC上运行的围棋程序Zen在让5子和让4子的情况下两次击败日籍九段棋手武宫正树。2013年，围棋程序Crazy Stone在让4子的情况下击败日籍九段棋手石田芳夫。

围棋的棋盘和棋子在计算机里以数组的形式保存。在计算机看来，一盘围棋长得就像图1-12中的样子。这是一个19×19的数组，计算机用它来表示围棋的棋盘，其中数字1表示黑棋，-1表示白棋，0表示空子。

![&#x56FE; 1 - 12 &#x76D8;&#x4E2D;&#x7684;&#x56F4;&#x68CB;&#x76D8;&#x9762;&#x5728;&#x8BA1;&#x7B97;&#x4E2D;&#x7684;&#x6837;&#x5B50;](.gitbook/assets/image%20%2830%29.png)

和音乐的传承方式一样，围棋也有自己的乐谱，称作棋谱。棋谱是一盘棋局对弈发展的过程纪录。在南北朝时期，就已经有了围棋棋谱的记载， 《[南史·柳恽传](http://wyw.5156edu.com/html/z7088m5646j4779.html)》载：“梁武帝好弈，使恽品定棋谱，登格者二百七十八人”。在还没有计算机之前，人们在纸上印刷棋盘，并在棋盘上绘上黑、白棋子，然后在黑、白棋双方落子的位置上注明该手手数（见图1-13）。

![&#x56FE; 1 - 13 &#x5370;&#x5237;&#x7248;&#x68CB;&#x8C31;](.gitbook/assets/image%20%2822%29.png)

### 1.5.1 SGF文件

计算机上也可以保存棋谱，目前电子版本的棋谱格式已经有了标准化，公认的标准是[Smart Game Format](https://www.red-bean.com/sgf/)（SGF），没有中文名，我们简称之为SGF文件。在后面章节讲述如何教计算机AI学习围棋时，棋谱就是最重要的学习材料。图1-14就是一局围棋的行棋记录。其中（FF\[4\]）表示SGF文件的格式版本，目前最新版本是第四版，版本向下兼容。（SZ\[19\]）表示棋盘的大小。现今的棋盘除了19×19的规格，还有13×13和9×9，这两种规格的棋盘一般只用于下快棋，也有15×15或者17×17的棋盘规格，但是比较罕见。（PB\[masato3012\]）和（PW\[petgo3\]）分别用于记录下棋者执黑方和执白方的名字。（RE\[W+Resign\]）记录这一局的棋局最终是哪方获胜，以何种方式获胜，Resign意思是对方主动认输，也有（RE\[W+14.50\]）这种情况，表示执白方胜利，并且以多14.5子胜出。（RU\[Chinese\]）表示游戏采取的规则，Chinese表示采用中国规则。（HA\[2\]）表示有让子，并且此局让出了两子。（AB）表示由于让子，黑棋先行在棋盘上摆子的位置。如果是白棋先放子，则用（AW）表示。图中剩下的部分就是整个行棋过程的纪录。（W\[dc\]）表示白棋下到棋盘上d线和c线的交叉点上。（B\[pp\]）同理，表示黑棋下到棋盘上p线和p线的交叉点上。有时候在SGF文件的最后，还会有（TW）和（TB）标记，它用于记录白子和黑子在棋局结束后所围的领地。

![&#x56FE; 1 - 14 SGF&#x6587;&#x4EF6;](.gitbook/assets/image%20%281%29.png)

棋盘的坐标系一般有四种，常见的有两种，分别是“横坐标为英文字母，纵坐标为阿拉伯数字的坐标系”和“横坐标和纵坐标都使用英文字母的坐标系”。SGF文件记录方法采用了后者。即棋盘的上方和下方用英文的前 19 个字母自左至右顺次标记它的 19 条纵线段，在棋盘的左边和右边用英文的前 19 个字母自下至上顺次标记它的 19 条横线段。我们不用特别的记住这种记法，在后续章节中，我们会使用[sgfmill](https://mjw.woodcraft.me.uk/sgfmill/)这个python3的库（python2的用户可以使用[gomill](https://mjw.woodcraft.me.uk/gomill/)）来专门处理SGF格式文件。需要记住的是，SGF文件使用节点（node）的概念来组织文件，节点之间使用分号（;）隔开。从图1-14中可以看出，在行棋记录前，基础的元数据都被封装在第一个节点里，之后每一步落子都会产生一个新的独立节点。

### 1.5.2 GTP协议

要使我们在计算机上制作的围棋AI具有实用性，与他人进行对弈是比不可少的。对弈可以和人进行，也可以和其它AI进行。为了方便人们通过计算机互联网相互交流围棋，[GTP](http://www.lysator.liu.se/~gunnar/gtp/)协议便应运而生。GTP的全称是Smart Game Format，它是一个文本传输协议，目前有GTP 1和GTP 2两个版本。GTP 2从2002年就开始了制定计划，但是似乎GTP 1运作的相当好，所以到目前为止GTP 2还一直停留在拟稿阶段。我们使用GTP 1作为标准的围棋通行协议，但是也尽可能地支持GTP 2，很多网络围棋软件会使用GTP 2中的命令。

要想我们制作的围棋AI能够在互联网平台上像一个普通人一样下棋，我们需要实现完整的GTP协议，不过这是一个费时费力的工作，并且和本书的主题相关性不大，在后面的相关章节中我将尽量引用别人现成的代码，就像牛顿一样，站在巨人的肩膀上。





